/*
조립컴 프로젝트 테이블 생성 SQL
최종 수정일 : 2023-05-15
*/

-- 1. 회원 테이블
DROP TABLE U_TBL CASCADE CONSTRAINTS;
CREATE TABLE U_TBL(
    U_ID            VARCHAR2(20)            CONSTRAINT PK_U_ID PRIMARY KEY,
    U_NAME          VARCHAR2(30)            NOT NULL,
    U_PW            VARCHAR2(60)            NOT NULL,
    U_EMAIL         VARCHAR2(30) UNIQUE     NOT NULL,
    U_ZIPCODE       VARCHAR2(10)            NOT NULL,
    U_ADDR          VARCHAR2(100)           NOT NULL,
    U_ADDR_DTL      VARCHAR2(100)           NOT NULL,
    U_PHONE         VARCHAR2(15)            NOT NULL,
    U_NIC           VARCHAR2(20) UNIQUE     NOT NULL,
    CHECK_EMAIL_RX  CHAR(1) DEFAULT 'N'     NOT NULL,
    U_GRADE         CHAR(1) DEFAULT 0       NOT NULL,
    U_PTS           NUMBER DEFAULT 0        NOT NULL,
    JOIN_DATE       DATE DEFAULT SYSDATE    NOT NULL,
    MODIFY_DATE     DATE DEFAULT SYSDATE    NOT NULL,
    LAST_LOGIN_DATE DATE DEFAULT SYSDATE    NOT NULL
);

-- 2. 카테고리 테이블
DROP TABLE CATEG_TBL CASCADE CONSTRAINTS;
CREATE TABLE CATEG_TBL(
    CATEG_CD        NUMBER          CONSTRAINT PK_CATEG_CD PRIMARY KEY,
    PAR_CATEG_CD    NUMBER,
    CATEG_NAME      VARCHAR2(50)    NOT NULL
);
ALTER TABLE CATEG_TBL
ADD FOREIGN KEY(PAR_CATEG_CD) REFERENCES CATEG_TBL (CATEG_CD);

-- 3. 상품 테이블
DROP TABLE P_TBL CASCADE CONSTRAINTS;
CREATE TABLE P_TBL(
    P_NO            NUMBER          CONSTRAINT PK_P_NO PRIMARY KEY,
    CATEG_CD        NUMBER,
    P_NAME          VARCHAR2(50)    NOT NULL,
    P_PX            NUMBER          NOT NULL,
    P_DC            NUMBER          NOT NULL,
    P_MFR           VARCHAR2(30)    NOT NULL,
    P_DTL        CLOB            NOT NULL,
    PIMG_NO         NUMBER,
    P_AMT           NUMBER          NOT NULL,
    P_PURCHASABLE   CHAR(1)         NOT NULL,
    REGISTER_DATE   DATE DEFAULT SYSDATE NOT NULL,
    MODIFY_DATE     DATE DEFAULT SYSDATE NOT NULL,
    FOREIGN KEY (CATEG_CD) REFERENCES CATEG_TBL (CATEG_CD)
);

-- 상품 이미지 테이블
DROP TABLE PIMG_TBL CASCADE CONSTRAINTS;
CREATE TABLE PIMG_TBL(
    PIMG_NO         NUMBER          CONSTRAINT PK_PIMG_NO PRIMARY KEY,
    P_NO            NUMBER,
    PIMG_OG_NAME    VARCHAR2(300)   NOT NULL,
    PIMG_SV_NAME    VARCHAR2(300)   NOT NULL,
    PIMG_SIZE       NUMBER          NOT NULL,
    SAVE_DATE       DATE DEFAULT SYSDATE NOT NULL,
    FOREIGN KEY (P_NO) REFERENCES P_TBL (P_NO)
);
ALTER TABLE P_TBL
ADD FOREIGN KEY (PIMG_NO) REFERENCES PIMG_TBL (PIMG_NO);

-- 4. 장바구니 테이블
DROP TABLE CART_TBL CASCADE CONSTRAINTS;
CREATE TABLE CART_TBL(
    CART_NO         NUMBER          CONSTRAINT PK_CART_NO PRIMARY KEY,
    P_NO            NUMBER,
    U_ID            VARCHAR2(20),
    PURCHASED_AMT   NUMBER          NOT NULL,
    FOREIGN KEY (P_NO) REFERENCES P_TBL (P_NO),
    FOREIGN KEY (U_ID) REFERENCES U_TBL (U_ID)
);

-- 5. 주문 테이블
DROP TABLE ORD_TBL CASCADE CONSTRAINTS;
CREATE TABLE ORD_TBL(
    ORD_NO              NUMBER          CONSTRAINT PK_ORD_NO PRIMARY KEY,
    U_ID                VARCHAR2(50),
    ORD_NAME            VARCHAR2(30)    NOT NULL,
    ORD_ZIPCODE         CHAR(5)         NOT NULL,
    ORD_ADDR            VARCHAR2(50)    NOT NULL,
    ORD_ADDR_DETAILS    VARCHAR2(50)    NOT NULL,
    ORD_PHONE           VARCHAR2(20)    NOT NULL,
    ORD_SUM             NUMBER          NOT NULL,
    ORDER_DATE          DATE            DEFAULT SYSDATE NOT NULL,
    FOREIGN KEY (U_ID) REFERENCES U_TBL (U_ID)
);

-- 6. 주문 상세 테이블
DROP TABLE OD_TBL CASCADE CONSTRAINTS;
CREATE TABLE OD_TBL(
    ORD_NO  NUMBER  CONSTRAINT PK_ORD_NO_P_NO PRIMARY KEY,
    P_NO    NUMBER,
    OD_AMT  NUMBER  NOT NULL,
    OD_SUM  NUMBER  NOT NULL,
    FOREIGN KEY (ORD_NO) REFERENCES ORD_TBL (ORD_NO),
    FOREIGN KEY (P_NO) REFERENCES P_TBL (P_NO)
);

-- 7. 게시판 테이블
DROP TABLE BRD_TBL CASCADE CONSTRAINTS;
CREATE TABLE BRD_TBL (
    BRD_NO_SEQ NUMBER           CONSTRAINT PK_BRD_NO_SEQ PRIMARY KEY,
    U_ID        VARCHAR2(20),
    BRD_TITLE  VARCHAR2(100)   NOT NULL,
    BRD_CONTENT   VARCHAR2(4000)  NOT NULL,
    WRITE_DATE  DATE            DEFAULT SYSDATE NOT NULL,
    FOREIGN KEY (U_ID) REFERENCES U_TBL (U_ID)
);



-- 8. 후기 테이블
DROP TABLE REV_TBL CASCADE CONSTRAINTS;
CREATE TABLE REV_TBL (
    REV_NO      NUMBER          CONSTRAINT PK_REV_NO PRIMARY KEY,
    U_ID        VARCHAR2(50),
    P_NO        NUMBER,
    REV_CONTENT  VARCHAR2(200)   NOT NULL,
    REV_STAR    NUMBER          NOT NULL,
    WRITE_DATE  DATE            DEFAULT SYSDATE NOT NULL,
    FOREIGN KEY (U_ID) REFERENCES U_TBL (U_ID),
    FOREIGN KEY (P_NO) REFERENCES P_TBL (P_NO)
);

-- 쿠폰 테이블
DROP TABLE CPN_TBL CASCADE CONSTRAINTS;
CREATE TABLE CPN_TBL (
    CPN_NO      NUMBER          CONSTRAINT PK_CPN_NO PRIMARY KEY,
    CPN_ID      VARCHAR2(50)    NOT NULL,
    DC_RATE     NUMBER,
    DC_SUM      NUMBER,
    DC_DETAIL   VARCHAR2(300)   NOT NULL,
    CPN_STATUS  CHAR(1)         NOT NULL
);

-- 쿠폰함 테이블
DROP TABLE CSTG_TBL CASCADE CONSTRAINTS;
CREATE TABLE CSTG_TBL (
    U_ID        VARCHAR2(50)    CONSTRAINT PK_CSTG_TBL PRIMARY KEY,
    CPN_NO      NUMBER,
    CPN_USED    CHAR(1)         NOT NULL,
    FOREIGN KEY (U_ID) REFERENCES U_TBL (U_ID),
    FOREIGN KEY (CPN_NO) REFERENCES CPN_TBL (CPN_NO)
);

-- 환불 정보 테이블
DROP TABLE RFD_TBL CASCADE CONSTRAINTS;
CREATE TABLE RFD_TBL(
    RFD_NO              NUMBER          CONSTRAINT PK_RFD_NO PRIMARY KEY,
    U_ID                VARCHAR2(50),
    P_NO                NUMBER,
    ORD_NAME            VARCHAR2(30)    NOT NULL,
    ORD_ZIPCODE         CHAR(5)         NOT NULL,
    ORD_ADDR            VARCHAR2(50)    NOT NULL,
    ORD_ADDR_DETAILS    VARCHAR2(50)    NOT NULL,
    ORD_PHONE           VARCHAR2(20)    NOT NULL,
    RFD_SUM             NUMBER          NOT NULL,
    REFUND_DATE          DATE            DEFAULT SYSDATE NOT NULL,
    FOREIGN KEY (U_ID) REFERENCES U_TBL (U_ID),
    FOREIGN KEY (P_NO) REFERENCES P_TBL (P_NO)
);

COMMIT;